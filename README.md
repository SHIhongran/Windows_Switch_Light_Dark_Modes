- # Windows 系统主题切换器

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/python-3.6+-green.svg)
![Platform](https://img.shields.io/badge/platform-Windows%2010%2F11-lightgrey.svg)

一个简洁优雅的 Windows 桌面应用程序，用于快速切换系统的浅色和暗色主题。

## 📸 预览

- 🎨 现代化的无边框界面设计
- 🚀 专业的启动画面体验
- 🔄 一键快速主题切换
- 📌 智能边缘吸附功能
- 🎯 自动隐藏与显示

## 🆕 v1.5.1 最新更新

### 🔧 稳定性修复
- **启动优化**：解决首次启动时屏幕边缘出现两个隐藏界面的问题
- **窗口状态改进**：优化 `show_main_window()` 方法中的窗口显示时序
- **启动体验完善**：确保启动时只出现一个功能正常的隐藏窗口
- **代码重构**：改进窗口初始化逻辑，提升程序稳定性

## v1.5 重大更新

### 启动体验增强
- **专业启动画面**：新增类似 WPS Office 的现代化启动画面，提升产品专业感
- **智能主题适配**：启动画面自动适配当前系统主题色彩
- **2秒启动体验**：优雅的初始化过程，显示程序信息和加载状态

### 操作流程优化
- **UI交互锁定**：执行耗时操作时自动锁定界面，防止用户误操作
- **智能锁定时长**：
  - 仅切换主题：0.5秒锁定
  - 切换主题+重启资源管理器：3秒锁定
- **视觉状态反馈**：半透明蒙版覆盖 + "处理中..." 提示
- **异步操作执行**：避免界面卡顿，提供流畅的用户体验

## v1.4.1 更新日志

- **重大 Bug 修复**：彻底解决了窗口在某些情况下（特别是通过边缘触发显示后）不会自动隐藏的问题。重构了底层的显示/隐藏逻辑，用统一的、可靠的鼠标位置轮询机制取代了之前不稳定的UI事件绑定，确保窗口在任何场景下都能按预期自动收缩。

## 功能特性

  ### 🎨 核心功能

  - **一键切换**：快速在 Windows 浅色和暗色主题间切换。

  - **状态显示**：实时显示当前系统主题模式。

  - **资源管理器重启**：可选择同时重启资源管理器以完全应用主题更改。

  ### 🖥️ 界面特性

  - **极简设计**：无边框现代化界面。

  - **边缘吸附**：拖拽到屏幕边缘自动吸附。

  - **自动隐藏**：窗口弹出后自动隐藏，只在边缘留下触发区域，节省屏幕空间，方便设置为开机启动。

  - **智能显示**：鼠标靠近边缘时自动显示窗口。

  ## 系统要求

  - **操作系统**：Windows 10/11

  - **Python 版本**：3.6+ (如果运行源码)

  - **权限要求**：普通用户权限即可

  ## 安装使用

  ### 方法一：直接运行 Python 脚本

  1. 确保已安装 Python 3.6+。

  1. 下载项目文件到本地。

  1. 运行主程序：

  ```
  python theme_switcher.py
  ```

  ### 方法二：打包为 EXE 文件

  1. 安装 PyInstaller：

  ```
  pip install pyinstaller
  ```

  1. 在项目目录下双击 “build.bat” 执行打包命令。

  1. 打包完成后，在dist目录下找到生成的 EXE 文件。

## 使用说明

### 启动体验 (v1.5 新增)

1. **专业启动**：双击程序后，屏幕中央会显示2秒的精美启动画面
2. **自动适配**：启动画面会根据当前系统主题自动调整颜色
3. **边缘停靠**：启动完成后，程序自动收缩到屏幕右侧边缘

### 基本操作

1. **显示窗口**：将鼠标移动到屏幕右侧边缘，程序窗口会自动滑出
2. **切换主题**：点击 "切换主题" 按钮，界面会显示锁定状态和处理进度
3. **智能锁定**：操作期间界面自动锁定，防止误操作，完成后自动解锁
4. **重启选项**：勾选 "切换后重启资源管理器" 可确保主题完全生效

  ### 高级功能

  1. **边缘吸附**：拖拽窗口到屏幕左、右或上边缘释放，窗口会自动吸附。

  1. **自动隐藏**：吸附后窗口会自动隐藏，只在边缘留下触发区域。

  1. **快速显示**：将鼠标移动到隐藏窗口的边缘区域，窗口会自动滑出。

  1. **自动收回**：鼠标离开窗口区域 2 秒后，窗口会自动收回隐藏。

## 文件结构

```
系统浅暗色切换/
├── theme_switcher.py          # 主程序文件 (v1.5 - 新增启动画面和UI锁定)
├── toggle_theme.bat           # 基础主题切换脚本
├── toggle_and_restart.bat     # 主题切换+重启资源管理器脚本
├── restart_explorer_only.bat  # 仅重启资源管理器脚本
├── requirements.txt           # 项目依赖说明
├── build.bat                  # 打包脚本
├── icon.ico                   # 程序图标
├── demo_v1_5.py              # v1.5 功能演示脚本
├── test_v1_5.py              # v1.5 功能测试脚本
├── test_v1.5.1_bugfix.py     # v1.5.1 bug修复测试脚本
├── CHANGELOG_v1.5.md         # v1.5 详细更新日志
├── BUGFIX_v1.5.1.md          # v1.5.1 bug修复文档
└── README.md                  # 项目说明文档
```

  ## 技术实现

  ### 架构设计

  - **前端**：Python Tkinter (轻量级 GUI 框架)

  - **主题切换**：通过调用批处理脚本修改 Windows 注册表

  - **状态检测**：直接读取注册表获取当前主题状态

  - **边缘检测**：使用 Windows API 进行鼠标位置追踪

  ### 核心模块

  - subprocess：执行外部批处理脚本

  - winreg：读取 Windows 注册表

  - ctypes：调用 Windows 原生 API

  - threading：多线程鼠标位置监控

## 更新日志

### v1.5.1 🔧

- **Bug 修复**：解决首次启动时屏幕边缘出现两个隐藏界面的问题
- **窗口状态优化**：优化 `show_main_window()` 方法中的窗口显示时序
- **启动体验改进**：确保启动时只出现一个功能正常的隐藏窗口
- **视觉流畅性**：消除窗口位置跳转和闪烁现象

### v1.5.1 🔧

- **启动优化**：解决首次启动时屏幕边缘出现两个隐藏界面的问题
- **窗口状态改进**：优化 `show_main_window()` 方法中的窗口显示时序
- **启动体验完善**：确保启动时只出现一个功能正常的隐藏窗口
- **代码重构**：改进窗口初始化逻辑，提升程序稳定性
- **Bug修复**：修复了v1.5中引入的窗口重复显示问题

### v1.5 🆕

- **启动画面系统**：新增专业级启动画面，400x225像素，居中显示2秒
- **主题自适应**：启动画面根据系统主题自动调整背景和文字颜色
- **UI交互锁定**：操作期间自动锁定界面，显示半透明蒙版和处理提示
- **智能锁定时长**：根据操作类型智能调整锁定时间（0.5s-3s）
- **异步操作**：使用 `root.after()` 实现非阻塞的批处理脚本执行
- **视觉反馈增强**：添加"处理中..."状态提示，提升用户体验
- **代码优化**：重构操作流程，增加错误处理和状态管理

### v1.4.1

- **重大 Bug 修复**：彻底解决窗口自动隐藏问题，重构显示/隐藏逻辑

### v1.3

- 优化窗口显示逻辑，页面弹出后自动隐藏，方便用户设置为开机启动。

### v1.2

- 实现边缘吸附和自动隐藏功能。
- 优化用户界面设计。
- 添加鼠标位置追踪。
- 改进错误处理机制。

### v1.1

- 添加资源管理器重启选项。
- 优化主题状态检测。
- 改进脚本执行机制。

### v1.0

- 基础主题切换功能。
- 简洁的图形界面。
- 注册表状态读取。

## 注意事项

1. **兼容性**：仅支持 Windows 10/11 系统。

2. **权限**：程序需要修改注册表，但使用的是用户级注册表项，无需管理员权限。

3. **启动体验** (v1.5+)：首次启动会显示2秒启动画面，这是正常的初始化过程。

4. **启动优化** (v1.5.1)：已修复启动时可能出现的窗口重复显示问题。

5. **操作锁定** (v1.5+)：执行主题切换时界面会临时锁定，请等待操作完成。

6. **资源管理器重启**：选择重启资源管理器时，桌面会短暂消失后恢复，这是正常现象。

7. **主题生效**：某些应用可能需要重启才能完全应用新主题。

## 故障排除

### 常见问题

**Q: 启动时看到两个窗口闪烁？** (v1.5.1已修复)

A: 此问题已在v1.5.1中修复。如仍遇到，请更新到最新版本。

**Q: 启动画面显示时间过长？** (v1.5)

A: 启动画面固定显示2秒，这是正常的初始化时间，请耐心等待。

**Q: 操作时界面被锁定无法点击？** (v1.5)

A: 这是防误操作的保护机制，请等待"处理中..."提示消失后再操作。

**Q: 主题切换后部分应用没有变化？**

A: 勾选 "切换后重启资源管理器" 选项，或手动重启相关应用。

**Q: 程序无法启动？**

A: 确保 Python 环境正确安装，或检查 EXE 文件是否完整。

**Q: 边缘吸附不工作？**

A: 确保将窗口完全拖拽到屏幕边缘并释放鼠标。

**Q: 自动隐藏后无法显示？**

A: 将鼠标移动到屏幕对应边缘的最边缘位置。

**Q: 启动画面颜色显示异常？** (v1.5)

A: 启动画面会自动适配系统主题，如显示异常请检查系统主题设置。

## 🤝 贡献指南

欢迎贡献代码！请遵循以下步骤：

1. Fork 本仓库
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

### 开发环境设置

```bash
# 克隆仓库
git clone https://github.com/yourusername/theme-switcher.git
cd theme-switcher

# 安装依赖
pip install -r requirements.txt

# 运行程序
python theme_switcher.py
```

### 代码规范

- 使用 4 个空格缩进
- 遵循 PEP 8 编码规范
- 添加适当的注释和文档字符串
- 确保新功能有相应的测试

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🙏 致谢

- 感谢所有贡献者的支持
- 感谢 Python Tkinter 社区
- 感谢 Windows API 文档

📞 联系方式
如果您有任何问题或建议，请通过以下方式联系：

🐛 Issues: GitHub Issues  
💬 Discussions: GitHub Discussions

⭐ 如果这个项目对您有帮助，请给它一个星标！